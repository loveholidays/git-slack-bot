# Release Management Guide

This document outlines the release process for git-slack-bot, including semantic versioning, changelog generation, and automated releases.

## Semantic Versioning

We follow [Semantic Versioning 2.0.0](https://semver.org/) (semver):

```
MAJOR.MINOR.PATCH
```

### Version Increment Rules

- **MAJOR** (`1.0.0` ‚Üí `2.0.0`): Breaking changes that are not backward compatible
- **MINOR** (`1.0.0` ‚Üí `1.1.0`): New features that are backward compatible
- **PATCH** (`1.0.0` ‚Üí `1.0.1`): Backward compatible bug fixes

### Examples

| Change Type | Version Change | Example |
|-------------|----------------|---------|
| Bug fix | `1.2.3` ‚Üí `1.2.4` | Fix emoji reactions not working |
| New feature | `1.2.3` ‚Üí `1.3.0` | Add support for custom webhook paths |
| Breaking change | `1.2.3` ‚Üí `2.0.0` | Change configuration format |

## Commit Message Convention

We use [Conventional Commits](https://www.conventionalcommits.org/) for structured commit messages:

### Format
```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

### Types
- `feat`: New features (triggers MINOR version)
- `fix`: Bug fixes (triggers PATCH version)
- `perf`: Performance improvements (triggers PATCH version)
- `refactor`: Code refactoring (triggers PATCH version)
- `docs`: Documentation changes (no version change)
- `test`: Test additions or modifications (no version change)
- `build`: Build system or CI changes (no version change)
- `ci`: CI configuration changes (no version change)
- `chore`: Maintenance tasks (no version change)

### Breaking Changes
Add `!` after type/scope or include `BREAKING CHANGE:` in footer (triggers MAJOR version):

```
feat!: change configuration format to YAML only

BREAKING CHANGE: Configuration files must now be in YAML format.
JSON configuration is no longer supported.
```

### Examples
```bash
# Patch version
git commit -m "fix: resolve webhook signature validation issue"
git commit -m "fix(slack): handle channel not found error gracefully"

# Minor version
git commit -m "feat: add support for custom emoji configurations"
git commit -m "feat(github): support GitHub Enterprise webhooks"

# Major version
git commit -m "feat!: replace JSON config with YAML-only configuration"
git commit -m "fix!: change default webhook path from /webhook to /"
```

## Release Process

### Automated Releases

Our release process is fully automated using GitHub Actions and GoReleaser:

1. **Create a tag** following semver (e.g., `v1.2.3`)
2. **Push the tag** to trigger the release workflow
3. **GitHub Actions** automatically:
   - Builds binaries for multiple platforms
   - Creates a GitHub release
   - Generates changelog from commits
   - Publishes Docker images
   - Updates release notes

### Manual Release Steps

1. **Ensure main branch is ready**:
   ```bash
   git checkout main
   git pull origin main
   ```

2. **Determine next version** based on commits since last release:
   ```bash
   # View commits since last tag
   git log $(git describe --tags --abbrev=0)..HEAD --oneline
   ```

3. **Create and push tag**:
   ```bash
   # Create tag (replace with appropriate version)
   git tag -a v1.2.3 -m "Release v1.2.3"

   # Push tag to trigger release
   git push origin v1.2.3
   ```

4. **Verify release** on GitHub and Docker registry

### Pre-release Testing

Before creating a release tag:

1. **Run tests locally**:
   ```bash
   make test
   make check
   ```

2. **Test Docker build**:
   ```bash
   docker build -t git-slack-bot:test .
   docker run --rm git-slack-bot:test --version
   ```

3. **Verify CI passes** on main branch

## Changelog

Changelogs are automatically generated by GoReleaser based on commit messages since the last tag.

### Changelog Sections

Our changelog groups commits by type:
- üéâ **New Features** (`feat:`)
- üêõ **Bug Fixes** (`fix:`)
- ‚ö° **Performance Improvements** (`perf:`)
- ‚ôªÔ∏è  **Refactors** (`refactor:`)
- üìö **Documentation** (`docs:`)
- üèóÔ∏è **Build & CI** (`build:`, `ci:`)
- üîß **Dependency Updates** (`chore:`, `deps:`)
- üì¶ **Others** (uncategorized)

### Manual Changelog Edits

After automated generation, you can:
1. Edit the release on GitHub
2. Add additional context or migration notes
3. Highlight breaking changes
4. Add contributor acknowledgments

## Version Management Tools

### Checking Current Version
```bash
# From binary
./git-slack-bot --version

# From Docker
docker run ghcr.io/loveholidays/git-slack-bot:latest --version

# From Git
git describe --tags --abbrev=0
```

### Version Bumping Helpers

Create shell aliases for common versioning tasks:

```bash
# Add to ~/.bashrc or ~/.zshrc
alias version-patch='git log $(git describe --tags --abbrev=0)..HEAD --oneline --grep="^fix" | wc -l'
alias version-minor='git log $(git describe --tags --abbrev=0)..HEAD --oneline --grep="^feat" | wc -l'
alias version-major='git log $(git describe --tags --abbrev=0)..HEAD --oneline --grep="!" | wc -l'
```

## Release Checklist

### Pre-Release
- [ ] All tests pass (`make test`)
- [ ] Linting passes (`make check`)
- [ ] Documentation is up to date
- [ ] Breaking changes are documented
- [ ] Version follows semver conventions

### Release
- [ ] Tag follows `vX.Y.Z` format
- [ ] Tag message includes release summary
- [ ] GitHub Actions workflow completes successfully
- [ ] GitHub release is created with changelog
- [ ] Docker images are published
- [ ] Binaries are attached to release

### Post-Release
- [ ] Release announcement (if major/significant)
- [ ] Update documentation if needed
- [ ] Monitor for any immediate issues
- [ ] Update project boards/milestones

## Troubleshooting Releases

### Common Issues

#### Release workflow fails
- Check GitHub Actions logs
- Verify GoReleaser configuration
- Ensure all required secrets are set
- Check for breaking changes in dependencies

#### Docker push fails
- Verify container registry permissions
- Check if image already exists
- Validate Dockerfile syntax

#### Changelog is empty/incorrect
- Ensure commits follow conventional format
- Check tag range includes intended commits
- Verify GoReleaser changelog configuration

### Emergency Fixes

For critical bugs requiring immediate release:

1. **Create hotfix branch**:
   ```bash
   git checkout -b hotfix/v1.2.4 v1.2.3
   ```

2. **Apply minimal fix**
3. **Test thoroughly**
4. **Tag and release from hotfix branch**
5. **Merge back to main**

## Contact

For questions about the release process:
- üìß supply@loveholidays.com
- üí¨ [GitHub Discussions](https://github.com/loveholidays/git-slack-bot/discussions)